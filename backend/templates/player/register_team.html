<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Team Registration</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-7">
        <h2 class="text-center mb-4">ü§ù Team Registration</h2>

        <form id="teamForm">
          <div class="mb-3">
            <label>Team Name</label>
            <input type="text" class="form-control" id="team_name" required>
          </div>
          <div class="mb-3">
            <label>Department</label>
            <input type="text" class="form-control" id="department" required>
          </div>
          <div class="mb-3">
            <label>Sport</label>
            <select class="form-select" id="sport" required>
              <option value="">-- Choose Team Sport --</option>
              <option>Cricket</option>
              <option>Football</option>
              <option>Basketball</option>
              <option>Volleyball</option>
              <option>Hockey</option>
            </select>
          </div>

          <h5 class="mt-4">Team Members</h5>
          <div id="players-container">
            <div class="row g-2 mb-2">
              <div class="col-md-6">
                <input class="form-control" placeholder="Player Name" required>
              </div>
              <div class="col-md-6">
                <input class="form-control" placeholder="Roll No" required>
              </div>
            </div>
          </div>

          <button type="button" class="btn btn-outline-primary mb-3" onclick="addPlayer()">+ Add Player</button>

          <button type="submit" class="btn btn-success w-100">‚úÖ Register Team</button>
        </form>

        <div class="text-center mt-3">
          <a href="/player/register">&larr; Back to Options</a>
        </div>
      </div>
    </div>
  </div>

<script>
function addPlayer() {
  const container = document.getElementById("players-container");
  const row = document.createElement("div");
  row.className = "row g-2 mb-2";
  row.innerHTML = `
    <div class="col-md-6"><input class="form-control" placeholder="Player Name" required></div>
    <div class="col-md-6"><input class="form-control" placeholder="Roll No" required></div>
  `;
  container.appendChild(row);
}

document.getElementById("teamForm").addEventListener("submit", async e => {
  e.preventDefault();

  const players = [];
  document.querySelectorAll("#players-container .row").forEach(row => {
    const inputs = row.querySelectorAll("input");
    players.push({ name: inputs[0].value, roll_no: inputs[1].value });
  });

  const data = {
    team_name: team_name.value,
    department: department.value,
    sport: sport.value,
    players
  };

  const res = await fetch("/player/api/register-team", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  });

  if(res.ok) {
    alert("Team registered!");
    location.href="/roles";
  }
});
</script>
</body>
</html>
